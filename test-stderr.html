<!DOCTYPE html>
<html>
<head>
    <title>测试Stderr显示</title>
    <meta charset="utf-8">
    <style>
        body { font-family: monospace; margin: 20px; }
        .log { margin: 5px 0; padding: 5px; border: 1px solid #ccc; }
        .error { background-color: #fee; }
        .stderr { background-color: #ffa; font-weight: bold; }
    </style>
</head>
<body>
    <h1>测试Stderr显示</h1>
    <button onclick="testPing()">测试Ping（应该没有stderr）</button>
    <button onclick="testInvalidHost()">测试无效主机名（应该有stderr）</button>
    <div id="logs"></div>

    <script>
    // 模拟接收到的WebSocket消息
    function simulateLog(data) {
        const logs = document.getElementById('logs');
        const div = document.createElement('div');
        div.className = 'log';
        
        if (data.level === 'error') {
            div.className += ' error';
        }
        
        let content = `[${data.level}] ${data.source}: ${data.message}`;
        
        // 如果有stderr，特别显示
        if (data.stderr) {
            content += `<div class="stderr">STDERR: ${data.stderr}</div>`;
        }
        
        div.innerHTML = content;
        logs.appendChild(div);
    }
    
    function testPing() {
        // 模拟ping不可达IP的日志
        simulateLog({
            level: "error",
            source: "ping",
            message: "主机 (192.168.5.4) ping失败: exit status 1",
            stderr: ""  // ping失败通常stderr是空的
        });
    }
    
    function testInvalidHost() {
        // 模拟ansible连接失败的日志
        simulateLog({
            level: "error",
            source: "ansible",
            message: "主机 (192.168.5.4) 执行失败: exit status 4 (exit code: 4)",
            stderr: "ssh: connect to host 192.168.5.4 port 22: Connection timed out"
        });
    }
    </script>
</body>
</html>